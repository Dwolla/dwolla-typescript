/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import { expect, test } from "vitest";
import { Dwolla } from "../index.js";
import { createTestHTTPClient } from "./testclient.js";

test("Customers List And Search Customers", async () => {
  const testHttpClient = createTestHTTPClient("listAndSearchCustomers");

  const dwolla = new Dwolla({
    serverURL: "https://api-sandbox.dwolla.com",
    httpClient: testHttpClient,
    security: {
      clientID: process.env["DWOLLA_CLIENT_ID"] ?? "value",
      clientSecret: process.env["DWOLLA_CLIENT_SECRET"] ?? "value",
    },
  });

  const result = await dwolla.customers.list({});
  expect(result).toBeDefined();
  // Assert structure rather than exact payload to tolerate real sandbox data
  expect(result.links).toBeDefined();
  expect(result.embedded).toBeDefined();
  expect(Array.isArray(result.embedded?.customers ?? [])).toBe(true);
  if ((result.embedded?.customers?.length ?? 0) > 0) {
    const first = result.embedded!.customers![0]!;
    expect(first.id).toBeDefined();
    expect(first.firstName).toBeDefined();
    expect(first.lastName).toBeDefined();
    expect(first.email).toBeDefined();
    expect(first.created).toBeInstanceOf(Date);
    expect(first.type).toBeDefined();
    expect(first.status).toBeDefined();
  }
});

test("Customers Get Customer", async () => {
  const testHttpClient = createTestHTTPClient("getCustomer");

  const dwolla = new Dwolla({
    serverURL: "https://api-sandbox.dwolla.com",
    httpClient: testHttpClient,
    security: {
      clientID: process.env["DWOLLA_CLIENT_ID"] ?? "value",
      clientSecret: process.env["DWOLLA_CLIENT_SECRET"] ?? "value",
    },
  });

  const result = await dwolla.customers.get({
    id: "86d3ca4b-8c3c-4ba9-88fc-3be8243daf9d",
  });
  expect(result).toBeDefined();
  // Assert structure rather than exact payload to tolerate real sandbox data
  expect(result.links).toBeDefined();
  expect(result.id).toBeDefined();
  expect(result.firstName).toBeDefined();
  expect(result.lastName).toBeDefined();
  expect(result.email).toBeDefined();
  expect(result.created).toBeInstanceOf(Date);
  expect(result.type).toBeDefined();
  expect(result.status).toBeDefined();
});

test("Customers Update", async () => {
  const testHttpClient = createTestHTTPClient("update");

  const dwolla = new Dwolla({
    serverURL: "https://api-sandbox.dwolla.com",
    httpClient: testHttpClient,
    security: {
      clientID: process.env["DWOLLA_CLIENT_ID"] ?? "value",
      clientSecret: process.env["DWOLLA_CLIENT_SECRET"] ?? "value",
    },
  });

  const result = await dwolla.customers.update({
    id: "86d3ca4b-8c3c-4ba9-88fc-3be8243daf9d",
    requestBody: {
      "address1": "99-99 33rd St",
      "businessClassification": "9ed3f670-7d6f-11e3-b1ce-5404a6144203",
      "businessName": "Jane Corp",
      "businessType": "soleProprietorship",
      "city": "Some City",
      "dateOfBirth": "1980-01-31",
      "ein": "00-0000000",
      "email": "solePropBusiness@email.com",
      "firstName": "Business",
      "lastName": "Owner",
      "operationType": "upgradeToVerifiedSoleProp",
      "postalCode": "11101",
      "ssn": "6789",
      "state": "NY",
      "type": "business",
    },
  });
  expect(result).toBeDefined();
  // Assert structure rather than exact payload to tolerate real sandbox data
  expect(result.links).toBeDefined();
  expect(result.id).toBeDefined();
  expect(result.firstName).toBeDefined();
  expect(result.lastName).toBeDefined();
  expect(result.email).toBeDefined();
  expect(result.created).toBeInstanceOf(Date);
  expect(result.type).toBeDefined();
  expect(result.status).toBeDefined();
});

test("Customers List Available Exchange Connections", async () => {
  const testHttpClient = createTestHTTPClient(
    "listAvailableExchangeConnections",
  );

  const dwolla = new Dwolla({
    serverURL: "https://api-sandbox.dwolla.com",
    httpClient: testHttpClient,
    security: {
      clientID: process.env["DWOLLA_CLIENT_ID"] ?? "value",
      clientSecret: process.env["DWOLLA_CLIENT_SECRET"] ?? "value",
    },
  });

  const result = await dwolla.customers.listAvailableConnections({
    id: "86d3ca4b-8c3c-4ba9-88fc-3be8243daf9d",
  });
  expect(result).toBeDefined();
  // Assert structure rather than exact payload to tolerate real sandbox data
  expect(result.links).toBeDefined();
  expect(result.links.self).toBeDefined();
  expect(result.links.customers).toBeDefined();
  expect(result.embedded).toBeDefined();
  expect(
    Array.isArray(result.embedded?.availableExchangeConnections ?? []),
  ).toBe(true);
});
