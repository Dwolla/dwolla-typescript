/*
 * Code originally generated by Speakeasy (https://www.speakeasy.com).
 */

import { expect, test } from "vitest";
import { Dwolla } from "../index.js";
import { createTestHTTPClient } from "./testclient.js";

test("Customers List And Search Customers", async () => {
  const testHttpClient = createTestHTTPClient("listAndSearchCustomers");

  const dwolla = new Dwolla({
    serverURL: "https://api-sandbox.dwolla.com",
    httpClient: testHttpClient,
    security: {
      clientID: process.env["DWOLLA_CLIENT_ID"] ?? "value",
      clientSecret: process.env["DWOLLA_CLIENT_SECRET"] ?? "value",
    },
  });

  const result = await dwolla.customers.list({});
  expect(result).toBeDefined();
  // Assert structure rather than exact payload to tolerate real sandbox data
  expect(result.links).toBeDefined();
  expect(result.embedded).toBeDefined();
  expect(Array.isArray(result.embedded?.customers ?? [])).toBe(true);
  if ((result.embedded?.customers?.length ?? 0) > 0) {
    const first = result.embedded!.customers![0]!;
    expect(first.id).toBeDefined();
    expect(first.firstName).toBeDefined();
    expect(first.lastName).toBeDefined();
    expect(first.email).toBeDefined();
    expect(first.created).toBeInstanceOf(Date);
    expect(first.type).toBeDefined();
    expect(first.status).toBeDefined();
  }
});

test("Customers Get Customer", async () => {
  const testHttpClient = createTestHTTPClient("getCustomer");

  const dwolla = new Dwolla({
    serverURL: "https://api-sandbox.dwolla.com",
    httpClient: testHttpClient,
    security: {
      clientID: process.env["DWOLLA_CLIENT_ID"] ?? "value",
      clientSecret: process.env["DWOLLA_CLIENT_SECRET"] ?? "value",
    },
  });

  const result = await dwolla.customers.get({
    id: "b2bedef2-2c66-4c4e-982d-1adcaa732b97",
  });
  expect(result).toBeDefined();
  // Assert structure rather than exact payload to tolerate real sandbox data
  expect(result.links).toBeDefined();
  expect(result.id).toBeDefined();
  expect(result.firstName).toBeDefined();
  expect(result.lastName).toBeDefined();
  expect(result.email).toBeDefined();
  expect(result.created).toBeInstanceOf(Date);
  expect(result.type).toBeDefined();
  expect(result.status).toBeDefined();
});

test("Customers Update", async () => {
  const testHttpClient = createTestHTTPClient("update");

  const dwolla = new Dwolla({
    serverURL: "https://api-sandbox.dwolla.com",
    httpClient: testHttpClient,
    security: {
      clientID: process.env["DWOLLA_CLIENT_ID"] ?? "value",
      clientSecret: process.env["DWOLLA_CLIENT_SECRET"] ?? "value",
    },
  });

  const result = await dwolla.customers.update({
    id: "86d3ca4b-8c3c-4ba9-88fc-3be8243daf9d",
    requestBody: {
      "operationType": "UpdateVerifiedBusiness",
      "address1": "1 Hagrid's Hut",
      "city": "Des Moines",
      "state": "IA",
      "postalCode": "50266",
    },
  });
  expect(result).toBeDefined();
  // Assert structure rather than exact payload to tolerate real sandbox data
  expect(result.links).toBeDefined();
  expect(result.id).toBeDefined();
  expect(result.firstName).toBeDefined();
  expect(result.lastName).toBeDefined();
  expect(result.email).toBeDefined();
  expect(result.created).toBeInstanceOf(Date);
  expect(result.type).toBeDefined();
  expect(result.status).toBeDefined();
});

test("Customers List Available Exchange Connections", async () => {
  const testHttpClient = createTestHTTPClient(
    "listAvailableExchangeConnections",
  );

  const dwolla = new Dwolla({
    serverURL: "https://api-sandbox.dwolla.com",
    httpClient: testHttpClient,
    security: {
      clientID: process.env["DWOLLA_CLIENT_ID"] ?? "value",
      clientSecret: process.env["DWOLLA_CLIENT_SECRET"] ?? "value",
    },
  });

  const result = await dwolla.customers.listAvailableConnections({
    id: "43a07339-253d-4fd5-9291-db72a081698b",
  });
  expect(result).toBeDefined();
  // Assert structure rather than exact payload to tolerate real sandbox data
  expect(result.links).toBeDefined();
  expect(result.links.self).toBeDefined();
  expect(result.links.customers).toBeDefined();
  expect(result.embedded).toBeDefined();
  expect(
    Array.isArray(result.embedded?.availableExchangeConnections ?? []),
  ).toBe(true);
});
