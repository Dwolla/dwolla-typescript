/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import * as z from "zod/v3";
import { remap as remap$ } from "../lib/primitives.js";
import { safeParse } from "../lib/schemas.js";
import { Result as SafeParseResult } from "../types/fp.js";
import { SDKValidationError } from "./errors/sdkvalidationerror.js";

export type ExchangeSessionSelf = {
  href: string;
  type: string;
  resourceType: string;
};

export type ExchangeSessionExchangePartner = {
  href: string;
  type: string;
  resourceType: string;
};

export type ExternalProviderSession = {
  /**
   * Present for MX exchange sessions.
   *
   * @remarks
   * Contains the URL to redirect the user to complete the authorization process.
   */
  href: string;
  type: string;
  resourceType: string;
};

export type ExchangeSessionLinks = {
  self: ExchangeSessionSelf;
  exchangePartner: ExchangeSessionExchangePartner;
  externalProviderSession?: ExternalProviderSession | undefined;
};

/**
 * Present for Checkout.com exchange sessions (Push to Card / debit card flow).
 *
 * @remarks
 * Use these fields to initialize the Checkout.com Flow component for card capture.
 */
export type ExternalProviderSessionData = {
  /**
   * Checkout.com payment session ID (e.g. ps_xxx).
   */
  id?: string | undefined;
  /**
   * Checkout.com payment session secret.
   */
  paymentSessionSecret?: string | undefined;
  /**
   * Checkout.com payment session token (base64) for Flow initialization.
   */
  paymentSessionToken?: string | undefined;
};

/**
 * Details of a previously created exchange session. Response shape varies by exchange partner.
 *
 * @remarks
 * - **MX**: includes `_links.external-provider-session.href` (redirect URL).
 * - **Plaid**: includes `externalProviderSessionToken` (Link initialization token).
 * - **Checkout.com**: includes `externalProviderSessionData` (payment session for Flow/debit card capture).
 */
export type ExchangeSession = {
  created: Date;
  links: ExchangeSessionLinks;
  /**
   * Present for Plaid exchange sessions.
   *
   * @remarks
   * Contains the token to initialize the Plaid Link flow.
   */
  externalProviderSessionToken?: string | undefined;
  /**
   * Present for Checkout.com exchange sessions (Push to Card / debit card flow).
   *
   * @remarks
   * Use these fields to initialize the Checkout.com Flow component for card capture.
   */
  externalProviderSessionData?: ExternalProviderSessionData | undefined;
};

/** @internal */
export const ExchangeSessionSelf$inboundSchema: z.ZodType<
  ExchangeSessionSelf,
  z.ZodTypeDef,
  unknown
> = z.object({
  href: z.string(),
  type: z.string(),
  "resource-type": z.string(),
}).transform((v) => {
  return remap$(v, {
    "resource-type": "resourceType",
  });
});

export function exchangeSessionSelfFromJSON(
  jsonString: string,
): SafeParseResult<ExchangeSessionSelf, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ExchangeSessionSelf$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ExchangeSessionSelf' from JSON`,
  );
}

/** @internal */
export const ExchangeSessionExchangePartner$inboundSchema: z.ZodType<
  ExchangeSessionExchangePartner,
  z.ZodTypeDef,
  unknown
> = z.object({
  href: z.string(),
  type: z.string(),
  "resource-type": z.string(),
}).transform((v) => {
  return remap$(v, {
    "resource-type": "resourceType",
  });
});

export function exchangeSessionExchangePartnerFromJSON(
  jsonString: string,
): SafeParseResult<ExchangeSessionExchangePartner, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ExchangeSessionExchangePartner$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ExchangeSessionExchangePartner' from JSON`,
  );
}

/** @internal */
export const ExternalProviderSession$inboundSchema: z.ZodType<
  ExternalProviderSession,
  z.ZodTypeDef,
  unknown
> = z.object({
  href: z.string(),
  type: z.string(),
  "resource-type": z.string(),
}).transform((v) => {
  return remap$(v, {
    "resource-type": "resourceType",
  });
});

export function externalProviderSessionFromJSON(
  jsonString: string,
): SafeParseResult<ExternalProviderSession, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ExternalProviderSession$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ExternalProviderSession' from JSON`,
  );
}

/** @internal */
export const ExchangeSessionLinks$inboundSchema: z.ZodType<
  ExchangeSessionLinks,
  z.ZodTypeDef,
  unknown
> = z.object({
  self: z.lazy(() => ExchangeSessionSelf$inboundSchema),
  "exchange-partner": z.lazy(() =>
    ExchangeSessionExchangePartner$inboundSchema
  ),
  "external-provider-session": z.lazy(() =>
    ExternalProviderSession$inboundSchema
  ).optional(),
}).transform((v) => {
  return remap$(v, {
    "exchange-partner": "exchangePartner",
    "external-provider-session": "externalProviderSession",
  });
});

export function exchangeSessionLinksFromJSON(
  jsonString: string,
): SafeParseResult<ExchangeSessionLinks, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ExchangeSessionLinks$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ExchangeSessionLinks' from JSON`,
  );
}

/** @internal */
export const ExternalProviderSessionData$inboundSchema: z.ZodType<
  ExternalProviderSessionData,
  z.ZodTypeDef,
  unknown
> = z.object({
  id: z.string().optional(),
  payment_session_secret: z.string().optional(),
  payment_session_token: z.string().optional(),
}).transform((v) => {
  return remap$(v, {
    "payment_session_secret": "paymentSessionSecret",
    "payment_session_token": "paymentSessionToken",
  });
});

export function externalProviderSessionDataFromJSON(
  jsonString: string,
): SafeParseResult<ExternalProviderSessionData, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ExternalProviderSessionData$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ExternalProviderSessionData' from JSON`,
  );
}

/** @internal */
export const ExchangeSession$inboundSchema: z.ZodType<
  ExchangeSession,
  z.ZodTypeDef,
  unknown
> = z.object({
  created: z.string().datetime({ offset: true }).transform(v => new Date(v)),
  _links: z.lazy(() => ExchangeSessionLinks$inboundSchema),
  externalProviderSessionToken: z.string().optional(),
  externalProviderSessionData: z.lazy(() =>
    ExternalProviderSessionData$inboundSchema
  ).optional(),
}).transform((v) => {
  return remap$(v, {
    "_links": "links",
  });
});

export function exchangeSessionFromJSON(
  jsonString: string,
): SafeParseResult<ExchangeSession, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ExchangeSession$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ExchangeSession' from JSON`,
  );
}
